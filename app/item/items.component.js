"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var nativescript_background_http_1 = require("nativescript-background-http");
var Picker = require("nativescript-imagepicker");
var camera = require("nativescript-camera");
var lodash_1 = require("lodash");
var Subject_1 = require("rxjs/Subject");
var platform_1 = require("tns-core-modules/platform");
var ItemsComponent = (function () {
    function ItemsComponent() {
        this.UploadSession = nativescript_background_http_1.session('image-upload');
    }
    ItemsComponent.prototype.ngOnInit = function () {
        this.request = {
            url: "http://httpbin.org/post",
            method: "POST",
            headers: {
                "Content-Type": "application/octet-stream",
                "File-Name": this.imageName
            },
            description: "{ 'uploading': " + this.imageName + " }"
        };
    };
    ItemsComponent.prototype.cameraOpen = function () {
        var _this = this;
        camera.requestPermissions();
        if (!camera.isAvailable()) {
            alert('You didn\'t allow the app to use camera');
            return;
        }
        camera.takePicture({
            saveToGallery: true,
            cameraFacing: 'front'
        })
            .then(function (imageAsset) {
            var image;
            if (platform_1.isAndroid) {
                image = {
                    fileUri: imageAsset.android
                };
            }
            else {
                image = imageAsset.ios;
            }
            return image;
        })
            .then(function (image) {
            return _this.uploadImagePicker(image);
        })
            .catch(function (err) {
            console.log("Error -> " + err.message);
        });
    };
    ItemsComponent.prototype.pickerOpen = function () {
        var context = Picker.create({
            mode: "single",
            mdeiaType: 'image'
        });
        this.startSelection(context);
    };
    ItemsComponent.prototype.startSelection = function (context) {
        var _this = this;
        context
            .authorize()
            .then(function () {
            return context.present();
        })
            .then(function (selection) {
            _this.uploadImagePicker(lodash_1.first(selection));
        })
            .catch(function (e) {
            console.error(e);
        });
    };
    ItemsComponent.prototype.uploadImagePicker = function (image) {
        this.uploadMultipartImagePicker(image)
            .subscribe({
            next: function (e) {
                console.log("Upload: " + (e.currentBytes / e.totalBytes) * 100);
            },
            error: function (e) {
                console.log(JSON.stringify(e));
            },
            complete: function () {
                console.log("complete");
            }
        });
    };
    ItemsComponent.prototype.uploadMultipartImagePicker = function (image) {
        var fileUri = image.fileUri;
        var request = {
            url: "http://httpbin.org/post",
            method: 'POST',
            headers: {
                "Content-Type": "application/octet-stream",
                "File-Name": fileUri,
                'Authorization': "Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJuYW1laWQiOiI4MzlmMDg4NC1jMmI3LTQ1ZGUtOTc1Yy0wOTYwMTY4MWE2M2EiLCJ1bmlxdWVfbmFtZSI6IjgzOWYwODg0LWMyYjctNDVkZS05NzVjLTA5NjAxNjgxYTYzYSIsImh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vYWNjZXNzY29udHJvbHNlcnZpY2UvMjAxMC8wNy9jbGFpbXMvaWRlbnRpdHlwcm92aWRlciI6IkFTUC5ORVQgSWRlbnRpdHkiLCJBc3BOZXQuSWRlbnRpdHkuU2VjdXJpdHlTdGFtcCI6ImFiNGNmOWE2LWVmYzEtNDZhNi05N2YyLWNlNzc5NjkxZGMxMCIsIlVzZXJJZCI6IjgzOWYwODg0LWMyYjctNDVkZS05NzVjLTA5NjAxNjgxYTYzYSIsImlzcyI6Imh0dHA6Ly9sb2NhbGhvc3QiLCJhdWQiOiI0MTRlMTkyN2EzODg0ZjY4YWJjNzlmNzI4MzgzN2ZkMSIsImV4cCI6MTU2MzgxMDQ4NiwibmJmIjoxNTExOTcwNDg2fQ.KUdYperMo_79QhR3sU3odmt7LzuCjdSMa25-AU9QLwA",
                "UserId": "2a2736cb-e5e6-4515-8ad7-02ea0cfef08b"
            },
            description: "Uploading " + fileUri
        };
        var params = [{ name: "nameOfFile", filename: fileUri, mimeType: 'image/JPG' }];
        console.log(JSON.stringify(params));
        var subject = new Subject_1.Subject();
        var task = this.UploadSession.multipartUpload(params, request);
        task.on('progress', function (e) { return subject.next(e); });
        task.on('error', function (e) { return subject.error(e); });
        task.on('complete', function (e) { return subject.complete(); });
        return subject;
    };
    ItemsComponent = __decorate([
        core_1.Component({
            selector: "ns-items",
            moduleId: module.id,
            templateUrl: "./items.component.html",
        }),
        __metadata("design:paramtypes", [])
    ], ItemsComponent);
    return ItemsComponent;
}());
exports.ItemsComponent = ItemsComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaXRlbXMuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiaXRlbXMuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsc0NBQWtEO0FBRWxELDZFQUFnRTtBQUNoRSxpREFBbUQ7QUFDbkQsNENBQThDO0FBQzlDLGlDQUErQjtBQUMvQix3Q0FBcUM7QUFDckMsc0RBQW9EO0FBTXBEO0lBS0k7UUFHSSxJQUFJLENBQUMsYUFBYSxHQUFHLHNDQUFPLENBQUMsY0FBYyxDQUFDLENBQUM7SUFDakQsQ0FBQztJQUVELGlDQUFRLEdBQVI7UUFDSSxJQUFJLENBQUMsT0FBTyxHQUFHO1lBQ1gsR0FBRyxFQUFFLHlCQUF5QjtZQUM5QixNQUFNLEVBQUUsTUFBTTtZQUNkLE9BQU8sRUFBRTtnQkFDTCxjQUFjLEVBQUUsMEJBQTBCO2dCQUMxQyxXQUFXLEVBQUUsSUFBSSxDQUFDLFNBQVM7YUFDOUI7WUFDRCxXQUFXLEVBQUUsaUJBQWlCLEdBQUcsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJO1NBQ3pELENBQUM7SUFDTixDQUFDO0lBRUQsbUNBQVUsR0FBVjtRQUFBLGlCQTZCQztRQTVCRyxNQUFNLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztRQUM1QixFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDeEIsS0FBSyxDQUFDLHlDQUF5QyxDQUFDLENBQUM7WUFDakQsTUFBTSxDQUFDO1FBQ1gsQ0FBQztRQUNELE1BQU0sQ0FBQyxXQUFXLENBQUM7WUFDZixhQUFhLEVBQUUsSUFBSTtZQUNuQixZQUFZLEVBQUUsT0FBTztTQUN4QixDQUFDO2FBQ0csSUFBSSxDQUFDLFVBQUMsVUFBVTtZQUNiLElBQUksS0FBUyxDQUFDO1lBQ2QsRUFBRSxDQUFBLENBQUMsb0JBQVMsQ0FBQyxDQUFBLENBQUM7Z0JBQ1YsS0FBSyxHQUFRO29CQUNULE9BQU8sRUFBRSxVQUFVLENBQUMsT0FB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LEVBQUUsT0FBTyxDQUFDLENBQUM7UUFDL0QsSUFBSSxDQUFDLEVBQUUsQ0FBQyxVQUFVLEVBQUUsVUFBQyxDQUFNLElBQUssT0FBQSxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFmLENBQWUsQ0FBQyxDQUFDO1FBRWpELElBQUksQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLFVBQUMsQ0FBQyxJQUFLLE9BQUEsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBaEIsQ0FBZ0IsQ0FBQyxDQUFDO1FBRTFDLElBQUksQ0FBQyxFQUFFLENBQUMsVUFBVSxFQUFFLFVBQUMsQ0FBQyxJQUFLLE9BQUEsT0FBTyxDQUFDLFFBQVEsRUFBRSxFQUFsQixDQUFrQixDQUFDLENBQUM7UUFFL0MsTUFBTSxDQUFDLE9BQU8sQ0FBQztJQUNuQixDQUFDO0lBeEhRLGNBQWM7UUFMMUIsZ0JBQVMsQ0FBQztZQUNQLFFBQVEsRUFBRSxVQUFVO1lBQ3BCLFFBQVEsRUFBRSxNQUFNLENBQUMsRUFBRTtZQUNuQixXQUFXLEVBQUUsd0JBQXdCO1NBQ3hDLENBQUM7O09BQ1csY0FBYyxDQTBIMUI7SUFBRCxxQkFBQztDQUFBLEFBMUhELElBMEhDO0FBMUhZLHdDQUFjIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQgfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuXG5pbXBvcnQgeyBzZXNzaW9uLCBTZXNzaW9uIH0gZnJvbSBcIm5hdGl2ZXNjcmlwdC1iYWNrZ3JvdW5kLWh0dHBcIjtcbmltcG9ydCAqIGFzIFBpY2tlciBmcm9tIFwibmF0aXZlc2NyaXB0LWltYWdlcGlja2VyXCI7XG5pbXBvcnQgKiBhcyBjYW1lcmEgZnJvbSBcIm5hdGl2ZXNjcmlwdC1jYW1lcmFcIjtcbmltcG9ydCB7IGZpcnN0IH0gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7U3ViamVjdH0gZnJvbSBcInJ4anMvU3ViamVjdFwiO1xuaW1wb3J0IHtpc0FuZHJvaWR9IGZyb20gXCJ0bnMtY29yZS1tb2R1bGVzL3BsYXRmb3JtXCI7XG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogXCJucy1pdGVtc1wiLFxuICAgIG1vZHVsZUlkOiBtb2R1bGUuaWQsXG4gICAgdGVtcGxhdGVVcmw6IFwiLi9pdGVtcy5jb21wb25lbnQuaHRtbFwiLFxufSlcbmV4cG9ydCBjbGFzcyBJdGVtc0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gICAgcHJpdmF0ZSByZXF1ZXN0IDogYW55O1xuXG4gICAgcHJpdmF0ZSBpbWFnZU5hbWUgOiBzdHJpbmc7XG4gICAgcHJpdmF0ZSBVcGxvYWRTZXNzaW9uOiBTZXNzaW9uO1xuICAgIGNvbnN0cnVjdG9yKFxuXG4gICAgKSB7XG4gICAgICAgIHRoaXMuVXBsb2FkU2Vzc2lvbiA9IHNlc3Npb24oJ2ltYWdlLXVwbG9hZCcpO1xuICAgIH1cblxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xuICAgICAgICB0aGlzLnJlcXVlc3QgPSB7XG4gICAgICAgICAgICB1cmw6IFwiaHR0cDovL2h0dHBiaW4ub3JnL3Bvc3RcIixcbiAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW1cIixcbiAgICAgICAgICAgICAgICBcIkZpbGUtTmFtZVwiOiB0aGlzLmltYWdlTmFtZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcInsgJ3VwbG9hZGluZyc6IFwiICsgdGhpcy5pbWFnZU5hbWUgKyBcIiB9XCJcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBjYW1lcmFPcGVuKCl7XG4gICAgICAgIGNhbWVyYS5yZXF1ZXN0UGVybWlzc2lvbnMoKTtcbiAgICAgICAgaWYgKCFjYW1lcmEuaXNBdmFpbGFibGUoKSkge1xuICAgICAgICAgICAgYWxlcnQoJ1lvdSBkaWRuXFwndCBhbGxvdyB0aGUgYXBwIHRvIHVzZSBjYW1lcmEnKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjYW1lcmEudGFrZVBpY3R1cmUoe1xuICAgICAgICAgICAgc2F2ZVRvR2FsbGVyeTogdHJ1ZSxcbiAgICAgICAgICAgIGNhbWVyYUZhY2luZzogJ2Zyb250J1xuICAgICAgICB9KVxuICAgICAgICAgICAgLnRoZW4oKGltYWdlQXNzZXQpID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgaW1hZ2U6YW55O1xuICAgICAgICAgICAgICAgIGlmKGlzQW5kcm9pZCl7XG4gICAgICAgICAgICAgICAgICAgIGltYWdlID0gPGFueT57XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxlVXJpOiBpbWFnZUFzc2V0LmFuZHJvaWRcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGltYWdlID0gaW1hZ2VBc3NldC5pb3M7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBpbWFnZTtcblxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC50aGVuKChpbWFnZSkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnVwbG9hZEltYWdlUGlja2VyKDxhbnk+IGltYWdlKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRXJyb3IgLT4gXCIgKyBlcnIubWVzc2FnZSk7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwaWNrZXJPcGVuKCl7XG4gICAgICAgIGxldCBjb250ZXh0ID0gUGlja2VyLmNyZWF0ZSg8YW55PntcbiAgICAgICAgICAgIG1vZGU6IFwic2luZ2xlXCIsXG4gICAgICAgICAgICBtZGVpYVR5cGU6ICdpbWFnZSdcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc3RhcnRTZWxlY3Rpb24oY29udGV4dCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzdGFydFNlbGVjdGlvbihjb250ZXh0OiBQaWNrZXIuSW1hZ2VQaWNrZXIpIHtcbiAgICAgICAgY29udGV4dFxuICAgICAgICAgICAgLmF1dGhvcml6ZSgpXG4gICAgICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbnRleHQucHJlc2VudCgpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC50aGVuKChzZWxlY3Rpb246IEFycmF5PFBpY2tlci5TZWxlY3RlZEFzc2V0PikgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMudXBsb2FkSW1hZ2VQaWNrZXIoZmlyc3Qoc2VsZWN0aW9uKSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgfVxuXG4gICAgcHJpdmF0ZSB1cGxvYWRJbWFnZVBpY2tlcihpbWFnZTogUGlja2VyLlNlbGVjdGVkQXNzZXQpIHtcblxuICAgICAgICB0aGlzLnVwbG9hZE11bHRpcGFydEltYWdlUGlja2VyKGltYWdlKVxuICAgICAgICAgICAgLnN1YnNjcmliZSh7XG4gICAgICAgICAgICAgICAgbmV4dDogKGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYFVwbG9hZDogJHsoZS5jdXJyZW50Qnl0ZXMgLyBlLnRvdGFsQnl0ZXMpICogMTAwfWApXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBlcnJvcjogKGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkoZSkpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgY29tcGxldGU6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJjb21wbGV0ZVwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICB9XG4gICAgdXBsb2FkTXVsdGlwYXJ0SW1hZ2VQaWNrZXIoaW1hZ2U6IFBpY2tlci5TZWxlY3RlZEFzc2V0KTogU3ViamVjdDxhbnk+IHtcblxuICAgICAgICBsZXQgIGZpbGVVcmkgPSBpbWFnZS5maWxlVXJpO1xuXG4gICAgICAgIGxldCByZXF1ZXN0ID0ge1xuICAgICAgICAgICAgdXJsOiBcImh0dHA6Ly9odHRwYmluLm9yZy9wb3N0XCIsXG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbVwiLFxuICAgICAgICAgICAgICAgIFwiRmlsZS1OYW1lXCI6IGZpbGVVcmksXG4gICAgICAgICAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBcIkJlYXJlciBleUowZVhBaU9pSktWMVFpTENKaGJHY2lPaUpJVXpJMU5pSjkuZXlKdVlXMWxhV1FpT2lJNE16bG1NRGc0TkMxak1tSTNMVFExWkdVdE9UYzFZeTB3T1RZd01UWTRNV0UyTTJFaUxDSjFibWx4ZFdWZmJtRnRaU0k2SWpnek9XWXdPRGcwTFdNeVlqY3RORFZrWlMwNU56VmpMVEE1TmpBeE5qZ3hZVFl6WVNJc0ltaDBkSEE2THk5elkyaGxiV0Z6TG0xcFkzSnZjMjltZEM1amIyMHZZV05qWlhOelkyOXVkSEp2YkhObGNuWnBZMlV2TWpBeE1DOHdOeTlqYkdGcGJYTXZhV1JsYm5ScGRIbHdjbTkyYVdSbGNpSTZJa0ZUVUM1T1JWUWdTV1JsYm5ScGRIa2lMQ0pCYzNCT1pYUXVTV1JsYm5ScGRIa3VVMlZqZFhKcGRIbFRkR0Z0Y0NJNkltRmlOR05tT1dFMkxXVm1ZekV0TkRaaE5pMDVOMll5TFdObE56YzVOamt4WkdNeE1DSXNJbFZ6WlhKSlpDSTZJamd6T1dZd09EZzBMV015WWpjdE5EVmtaUzA1TnpWakxUQTVOakF4TmpneFlUWXpZU0lzSW1semN5STZJbWgwZEhBNkx5OXNiMk5oYkdodmMzUWlMQ0poZFdRaU9pSTBNVFJsTVRreU4yRXpPRGcwWmpZNFlXSmpOemxtTnpJNE16Z3pOMlprTVNJc0ltVjRjQ0k2TVRVMk16Z3hNRFE0Tml3aWJtSm1Jam94TlRFeE9UY3dORGcyZlEuS1VkWXBlck1vXzc5UWhSM3NVM29kbXQ3THp1Q2pkU01hMjUtQVU5UUx3QVwiLFxuICAgICAgICAgICAgICAgIFwiVXNlcklkXCI6IFwiMmEyNzM2Y2ItZTVlNi00NTE1LThhZDctMDJlYTBjZmVmMDhiXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogYFVwbG9hZGluZyAke2ZpbGVVcml9YFxuICAgICAgICB9O1xuXG4gICAgICAgIGxldCBwYXJhbXMgPSBbeyBuYW1lOiBcIm5hbWVPZkZpbGVcIiwgZmlsZW5hbWU6IGZpbGVVcmksIG1pbWVUeXBlOiAnaW1hZ2UvSlBHJyB9XTtcbiAgICAgICAgY29uc29sZS5sb2coSlNPTi5zdHJpbmdpZnkocGFyYW1zKSk7XG5cbiAgICAgICAgbGV0IHN1YmplY3QgPSBuZXcgU3ViamVjdDxhbnk+KCk7XG4gICAgICAgIGxldCB0YXNrID0gdGhpcy5VcGxvYWRTZXNzaW9uLm11bHRpcGFydFVwbG9hZChwYXJhbXMsIHJlcXVlc3QpO1xuICAgICAgICB0YXNrLm9uKCdwcm9ncmVzcycsIChlOiBhbnkpID0+IHN1YmplY3QubmV4dChlKSk7XG5cbiAgICAgICAgdGFzay5vbignZXJyb3InLCAoZSkgPT4gc3ViamVjdC5lcnJvcihlKSk7XG5cbiAgICAgICAgdGFzay5vbignY29tcGxldGUnLCAoZSkgPT4gc3ViamVjdC5jb21wbGV0ZSgpKTtcblxuICAgICAgICByZXR1cm4gc3ViamVjdDtcbiAgICB9XG5cbn0iXX0=